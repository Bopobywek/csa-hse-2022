# Отчёт по домашнему заданию №2

## Содержание
- [Запуск программы и первое тестирование](#Запуск_программы_и_первое_тестирование)
- [Отладка и коррекция программы](#Отладка_и_коррекция_программы)
- [Тестирование исправленной программы](#Тестирование_исправленной_программы)
- [Результаты и исходные коды](#Результаты_и_исходные_коды)

## Запуск программы и первое тестирование
Для оценки работоспособности программы попробуем скомпилировать её, а затем запустим с некоторым набором данных.

```bash
    gcc -g shell-sort.c -o shell-sort
    ./shell-sort 2 1 5 -12 3 -9
```

Компиляция прошла успешно и мы получили следующий вывод: `Output: -12 -9 1 2 3 5 N`
На первый взгляд, всё корректно. Попробуем запустить программу ещё с некоторыми наборами данных.

Для удобства проведения тестирования и возможной последущей отладки напишем простой скрипт на языке Python. Этот скрипт сначала будет вызывать программу со случайно сгенерированными наборами данных, а затем проверять, что программа вернула корректный результат. В файле test.py приведен полный код скрипта.

Итак, запускаем 7 тестов:
```bash
python3 test.py ./shell-sort
```

Получаем следующий результат:
```
Wrong answer on test [-94, 89, -30]
Correct answer is [-94, -30, 89]
Program answer is [-94, -30, 0]

Wrong answer on test [-43, -65, 88, -74]
Correct answer is [-74, -65, -43, 88]
Program answer is [-74, -65, -43, 0]

Wrong answer on test [-78, 51, 8, -92, -93, -77, -45]
Correct answer is [-93, -92, -78, -77, -45, 8, 51]
Program answer is [-93, -92, -78, -77, -45, 0, 8]

Wrong answer on test [29, 54, -94, 43]
Correct answer is [-94, 29, 43, 54]
Program answer is [-94, 0, 29, 43]

Wrong answer on test [83, 66, 79, 39]
Correct answer is [39, 66, 79, 83]
Program answer is [0, 39, 66, 79]

Test [-44, 14, 50, -29, -99, 94]
Program answer is correct

Wrong answer on test [78, 8, -13, -29]
Correct answer is [-29, -13, 8, 78]
Program answer is [-29, -13, 0, 8]
```

Обнаруживаем сразу большое количество случаев, на которых программа выдает неправильный ответ.

## Отладка и коррекция программы
Воспользуемся `gdb`:
```bash
gdb ./shell-sort
```

Для начала проверим, что программа корректно получает данные. Поставим точку останова на функции `main` и запустим выполнение программы на наборе из условия `2 1 5 -12 3 -9`, а затем перейдем к моменту, когда в массив `a` записаны значения.

```
b main
r 2 1 5 -12 3 -9
until 36
print *a@(argc - 1)
```

В выводе видим: `$1 = {2, 1, 5, -12, 3, -9}`. Всё верно...
Тогда проверим, что получает функция `shell_sort`

```
step
print *a@size
print size
```

Смотрим результат:
```
$2 = {2, 1, 5, -12, 3, 9, 134481}
$3 = 7
```

Вот и ошибка! Получается, в `main` в строке `shell_sort(a, argc);` передаётся неправильный размер, который на 1 больше реального, а это, в свою очередь, приводит к тому, что на последнюю позицию массива попадает мусор -- тот самый странный 0 (или другое число). На некоторых наборах эта ошибка остаётся незамеченной, так как число-мусор слишком большое и даже после сортировки остаётся на последнем месте и не отображается в выводе, потому что печатаются первые `argc - 1` элементов.

Исправим исходный код программы, заменив `shell_sort(a, argc);` на `shell_sort(a, argc - 1);`.

## Тестирование исправленной программы
Перекомпилируем программу и запустим ранее написанный скрипт снова.

```bash
gcc -g shell-sort.c -o shell-sort
python3 test.py ./shell-sort
```

Отлично, теперь программа работает корректно:
```
Test [-94, 89, -30]
Program answer is correct

Test [-43, -65, 88, -74]
Program answer is correct

Test [-78, 51, 8, -92, -93, -77, -45]
Program answer is correct

Test [29, 54, -94, 43]
Program answer is correct

Test [83, 66, 79, 39]
Program answer is correct

Test [-44, 14, 50, -29, -99, 94]
Program answer is correct

Test [78, 8, -13, -29]
Program answer is correct
```

## Результаты и исходные коды
Результатом выполнения домашнего задания был написан скрипт для тестирования программы, проведена отладка и коррекция программы.
